# æ€§èƒ½ä¼˜åŒ–é‡æ„æ–¹æ¡ˆ - Deadly Delivery

> åŸºäº PageSpeed Insights æ¡Œé¢æŠ¥å‘Š (2025-11-24)
> ç›®æ ‡ï¼šDesktop Performance 80+ | LCP â‰¤ 2.5s | TBT â‰¤ 200ms

---

## ğŸ“Š å½“å‰æ€§èƒ½åˆ†æ

### ä¸»è¦æ€§èƒ½ç“¶é¢ˆ

| æŒ‡æ ‡ | å½“å‰å€¼ | ç›®æ ‡å€¼ | ä¼˜åŒ–æ½œåŠ› |
|------|--------|--------|----------|
| **LCP** | ~3.8s | â‰¤2.5s | -1.3s (34%â†“) |
| **TBT** | ~1200ms | â‰¤200ms | -1000ms (83%â†“) |
| **FCP** | ~2.1s | â‰¤1.8s | -0.3s (14%â†“) |
| **CLS** | 0.02 | â‰¤0.1 | âœ… å·²è¾¾æ ‡ |

### å…³é”®é—®é¢˜æ¸…å•

#### ğŸ”´ é«˜ä¼˜å…ˆçº§ (P0) - å½±å“ LCP

1. **èƒŒæ™¯å›¾ç‰‡æœªä¼˜åŒ– (-1.2s)**
   - `backend.png`: 2.6MB
   - `backend2.png`: 1.6MB
   - `hero-bg.jpg`: 1.4MB
   - ä½ç½®: `src/app/[locale]/layout.tsx:186`
   - æ–¹æ¡ˆ: è½¬æ¢ä¸º WebP/AVIF + Next.js Image ç»„ä»¶

2. **ç¼ºå°‘ preconnect (-0.4s)**
   - YouTube CDN: `i.ytimg.com`
   - Google Analytics: `www.googletagmanager.com`
   - Ahrefs: `analytics.ahrefs.com`
   - Microsoft Clarity: `www.clarity.ms`
   - ä½ç½®: `layout.tsx <head>` ç¼ºå¤±

3. **å­—ä½“åŠ è½½é—ªçƒ (-0.3s)**
   - Google Fonts æœªé…ç½® `font-display:swap`
   - ä½ç½®: `layout.tsx:11-20`

#### ğŸŸ¡ ä¸­ä¼˜å…ˆçº§ (P1) - å½±å“ TBT

4. **YouTube iframe åŒæ­¥åŠ è½½ (-500ms)**
   - 4 ä¸ª iframe é˜»å¡ä¸»çº¿ç¨‹
   - ä½ç½®: `src/app/[locale]/page.tsx:266-357`
   - æ–¹æ¡ˆ: ä½¿ç”¨ `lite-youtube-embed` æ‡’åŠ è½½

5. **æœªé…ç½®é™æ€èµ„æºé•¿ç¼“å­˜ (-200ms)**
   - ç¼ºå°‘ `Cache-Control` headers
   - ä½ç½®: `next.config.js`

#### ğŸŸ¢ ä½ä¼˜å…ˆçº§ (P2) - ç»´æŠ¤æ€§ä¼˜åŒ–

6. **å†—ä½™å›¾ç‰‡æ–‡ä»¶æ¸…ç†**
   - `hero.png` (388KB) â†’ å·²æœ‰ `hero.webp` (34KB)
   - 16 ä¸ªæœªä½¿ç”¨çš„èƒŒæ™¯å›¾

7. **Brotli å‹ç¼©éªŒè¯**
   - Vercel é»˜è®¤æ”¯æŒï¼Œéœ€ç¡®è®¤æµè§ˆå™¨åå•†

8. **Lighthouse CI é›†æˆ**
   - é˜²æ­¢æ€§èƒ½å›é€€

---

## ğŸ¯ ä¼˜åŒ–æ–¹æ¡ˆè¯¦è§£

### Sprint 1: å›¾ç‰‡ä¼˜åŒ– (é¢„æœŸ LCP -1.2s)

#### 1.1 èƒŒæ™¯å›¾ç‰‡è½¬ WebP

**æ‰§è¡Œæ­¥éª¤:**

```bash
# 1. è½¬æ¢èƒŒæ™¯å›¾ä¸º WebP
npm install -D sharp
node scripts/convert-images-to-webp.js

# é¢„æœŸäº§ç‰©
public/images/backgrounds/backend.webp      # 2.6MB â†’ ~180KB (-93%)
public/images/backgrounds/backend2.webp     # 1.6MB â†’ ~120KB (-93%)
public/images/backgrounds/hero-bg.webp      # 1.4MB â†’ ~95KB (-93%)
```

**ä»£ç æ”¹åŠ¨:**

```diff
# src/app/[locale]/layout.tsx
- style={{ backgroundImage: 'url(/images/backgrounds/backend.png)' }}
+ style={{ backgroundImage: 'url(/images/backgrounds/backend.webp)' }}
```

**æ›´ä¼˜æ–¹æ¡ˆ (æ¨è):**

ä½¿ç”¨ Next.js `<Image>` ç»„ä»¶æ›¿ä»£ inline styleï¼š

```tsx
// src/app/[locale]/layout.tsx
import Image from 'next/image';

<div className="relative min-h-screen">
  <Image
    src="/images/backgrounds/backend.webp"
    alt="Background"
    fill
    priority
    quality={75}
    className="object-cover object-center -z-10"
  />
  <div className="absolute inset-0 bg-black/60 backdrop-blur-[2px]"></div>
  {/* å…¶ä»–å†…å®¹ */}
</div>
```

#### 1.2 æ¸…ç†å†—ä½™å›¾ç‰‡

```bash
# åˆ é™¤å·²ä¼˜åŒ–çš„æ—§æ ¼å¼
rm public/images/hero.png
rm public/images/backgrounds/{backend,backend2,hero-bg}.{png,jpg}

# ä¿ç•™ WebP ç‰ˆæœ¬
ls public/images/backgrounds/*.webp
```

---

### Sprint 2: é¢„è¿æ¥å¤–åŸŸ (é¢„æœŸ FCP -0.4s)

**ä»£ç æ”¹åŠ¨:**

```tsx
// src/app/[locale]/layout.tsx:134
<head>
  {/* DNS Prefetch - æå‰è§£æåŸŸå */}
  <link rel="dns-prefetch" href="https://www.googletagmanager.com" />
  <link rel="dns-prefetch" href="https://analytics.ahrefs.com" />
  <link rel="dns-prefetch" href="https://www.clarity.ms" />

  {/* Preconnect - æå‰å»ºç«‹è¿æ¥ (DNS + TCP + TLS) */}
  <link rel="preconnect" href="https://i.ytimg.com" crossOrigin="anonymous" />
  <link rel="preconnect" href="https://www.googletagmanager.com" crossOrigin="anonymous" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossOrigin="anonymous" />

  {/* Google Analytics */}
  {gaId && (
    ...
```

**åŸç†:**
- `dns-prefetch`: ä»…è§£æ DNS (~50ms)
- `preconnect`: DNS + TCP æ¡æ‰‹ + TLS åå•† (~300ms)
- å¯¹äºå…³é”®èµ„æº (YouTube è§†é¢‘ç¼©ç•¥å›¾) ä½¿ç”¨ `preconnect`

---

### Sprint 3: å­—ä½“ä¼˜åŒ– (é¢„æœŸ FCP -0.3s)

**ä»£ç æ”¹åŠ¨:**

```tsx
// src/app/[locale]/layout.tsx:11-20
const geistSans = Geist({
  variable: "--font-geist-sans",
  subsets: ["latin"],
  weight: ["400", "500", "600", "700"],
  display: "swap",  // âœ… æ·»åŠ æ­¤è¡Œ
});

const geistMono = Geist_Mono({
  variable: "--font-geist-mono",
  subsets: ["latin"],
  display: "swap",  // âœ… æ·»åŠ æ­¤è¡Œ
});
```

**æ•ˆæœ:**
- `font-display: swap` â†’ æ–‡å­—ç«‹å³æ˜¾ç¤ºï¼ˆä½¿ç”¨ç³»ç»Ÿå­—ä½“ï¼‰ï¼Œå­—ä½“åŠ è½½å®Œæˆåæ›¿æ¢
- é¿å… FOIT (Flash of Invisible Text)
- ç¬¦åˆ Web.dev æœ€ä½³å®è·µ

---

### Sprint 4: YouTube æ‡’åŠ è½½ (é¢„æœŸ TBT -500ms)

**å®‰è£…ä¾èµ–:**

```bash
npm install lite-youtube-embed
```

**ä»£ç æ”¹åŠ¨:**

```tsx
// src/app/[locale]/page.tsx
import 'lite-youtube-embed/src/lite-yt-embed.css';

// æ›¿æ¢ iframe ä¸º lite-youtube
<lite-youtube videoid="L093XqyLGrw" playlabel="Deadly Delivery Guide"></lite-youtube>
<lite-youtube videoid="a707py2WoUU" playlabel="Ultimate Beginner Guide"></lite-youtube>
<lite-youtube videoid="MaYmdAMVxQY" playlabel="Sublevel 1-20 Walkthrough"></lite-youtube>
<lite-youtube videoid="mvh_QFTpa1w" playlabel="All Entities Showcase"></lite-youtube>
```

**æ·»åŠ ç±»å‹å£°æ˜:**

```tsx
// src/types/lite-youtube.d.ts
declare namespace JSX {
  interface IntrinsicElements {
    'lite-youtube': React.DetailedHTMLProps<React.HTMLAttributes<HTMLElement>, HTMLElement> & {
      videoid: string;
      playlabel?: string;
    };
  }
}
```

**ä¼˜åŠ¿:**
- é¦–å±ä»…åŠ è½½ç¼©ç•¥å›¾ (23KB vs 500KB iframe)
- ç‚¹å‡»æ—¶æ‰åŠ è½½ YouTube Player
- å‡å°‘ä¸»çº¿ç¨‹é˜»å¡ ~500ms

---

### Sprint 5: ç¼“å­˜ç­–ç•¥ (é¢„æœŸé‡å¤è®¿é—® -60%)

**ä»£ç æ”¹åŠ¨:**

```js
// next.config.js
const nextConfig = {
  // ... å…¶ä»–é…ç½®
  async headers() {
    return [
      {
        source: '/:all*(svg|jpg|jpeg|png|webp|avif|gif|ico|woff|woff2)',
        headers: [
          {
            key: 'Cache-Control',
            value: 'public, max-age=31536000, immutable',
          },
        ],
      },
      {
        source: '/_next/static/:path*',
        headers: [
          {
            key: 'Cache-Control',
            value: 'public, max-age=31536000, immutable',
          },
        ],
      },
    ];
  },
};
```

**éªŒè¯å‘½ä»¤:**

```bash
# æœ¬åœ°æµ‹è¯•
curl -I http://localhost:3000/images/hero.webp | grep -i cache-control

# ç”Ÿäº§éªŒè¯
curl -I https://deadlydelivery.net/images/hero.webp | grep -i "cache-control\|content-encoding"
```

---

### Sprint 6: Brotli å‹ç¼©éªŒè¯

**éªŒè¯æ­¥éª¤:**

```bash
# 1. æ£€æŸ¥ Vercel éƒ¨ç½²
curl -H "Accept-Encoding: br,gzip" -I https://deadlydelivery.net/_next/static/css/app.css

# é¢„æœŸè¾“å‡º
# content-encoding: br  âœ… Brotli
# content-encoding: gzip  âŒ éœ€æ’æŸ¥

# 2. æœ¬åœ°æµ‹è¯• (éœ€ç”Ÿäº§æ„å»º)
npm run build
npx serve out -c vercel.json
```

**Vercel é…ç½® (å¦‚æœéœ€è¦å¼ºåˆ¶):**

```json
// vercel.json
{
  "headers": [
    {
      "source": "/(.*)",
      "headers": [
        {
          "key": "Accept-Encoding",
          "value": "br, gzip, deflate"
        }
      ]
    }
  ]
}
```

---

### Sprint 7: Lighthouse CI é›†æˆ

**å®‰è£…é…ç½®:**

```bash
npm install -D @lhci/cli

# åˆ›å»ºé…ç½®æ–‡ä»¶
cat > lighthouserc.js << 'EOF'
module.exports = {
  ci: {
    collect: {
      url: ['http://localhost:3000/', 'http://localhost:3000/codes/active-codes'],
      numberOfRuns: 3,
    },
    assert: {
      preset: 'lighthouse:recommended',
      assertions: {
        'categories:performance': ['error', { minScore: 0.8 }],
        'categories:accessibility': ['warn', { minScore: 0.9 }],
        'categories:seo': ['warn', { minScore: 0.9 }],
      },
    },
    upload: {
      target: 'temporary-public-storage',
    },
  },
};
EOF
```

**GitHub Actions å·¥ä½œæµ:**

```yaml
# .github/workflows/lighthouse.yml
name: Lighthouse CI
on: [pull_request]

jobs:
  lhci:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version: 20
      - run: npm ci
      - run: npm run build
      - run: npm run start & npx wait-on http://localhost:3000
      - run: npx @lhci/cli autorun
```

**æœ¬åœ°æµ‹è¯•:**

```bash
npm run build && npm run start
npx @lhci/cli autorun
```

---

## ğŸ“ˆ é¢„æœŸä¼˜åŒ–æ•ˆæœ

| é˜¶æ®µ | ä¼˜åŒ–é¡¹ | LCP æ”¹å–„ | TBT æ”¹å–„ | ç´¯è®¡å¾—åˆ† |
|------|--------|----------|----------|----------|
| **Sprint 1** | å›¾ç‰‡ WebP | -1.2s | - | +15 |
| **Sprint 2** | Preconnect | -0.4s | - | +20 |
| **Sprint 3** | Font Display | -0.3s | - | +24 |
| **Sprint 4** | YouTube æ‡’åŠ è½½ | - | -500ms | +32 |
| **Sprint 5** | ç¼“å­˜ç­–ç•¥ | -0.2s | -200ms | +38 |
| **æ€»è®¡** | - | **-2.1s** | **-700ms** | **+38** |

**é¢„æµ‹æœ€ç»ˆåˆ†æ•°:**
- Performance: 52 â†’ **90** (ç›®æ ‡ 80+) âœ…
- LCP: 3.8s â†’ **1.7s** (ç›®æ ‡ â‰¤2.5s) âœ…
- TBT: 1200ms â†’ **500ms** (ä»éœ€ä¼˜åŒ–ï¼Œä½† â‰¤200ms éœ€è¦ SSG/ISR)

---

## ğŸš€ æ‰§è¡Œè®¡åˆ’

### Week 1 (é«˜ä¼˜å…ˆçº§ - æ ¸å¿ƒ Web Vitals)

- [x] Sprint 1: èƒŒæ™¯å›¾è½¬ WebP (2 å¤©)
- [x] Sprint 2: æ·»åŠ  preconnect (0.5 å¤©)
- [x] Sprint 3: å­—ä½“ font-display (0.5 å¤©)
- [ ] éƒ¨ç½²éªŒè¯ + PageSpeed Insights æµ‹è¯• (1 å¤©)

**é¢„æœŸæ”¶ç›Š:** Performance +24 åˆ†, LCP -1.9s

### Week 2 (ä¸­ä¼˜å…ˆçº§ - äº¤äº’ä¼˜åŒ–)

- [ ] Sprint 4: YouTube æ‡’åŠ è½½ (1 å¤©)
- [ ] Sprint 5: ç¼“å­˜ç­–ç•¥ (1 å¤©)
- [ ] Sprint 6: Brotli éªŒè¯ (0.5 å¤©)
- [ ] å‹åŠ›æµ‹è¯• + çœŸå®ç”¨æˆ·ç›‘æ§ (1 å¤©)

**é¢„æœŸæ”¶ç›Š:** Performance +14 åˆ†, TBT -700ms

### Week 3 (ä½ä¼˜å…ˆçº§ - é•¿æœŸç»´æŠ¤)

- [ ] Sprint 7: Lighthouse CI (1 å¤©)
- [ ] æ¸…ç†å†—ä½™å›¾ç‰‡ (0.5 å¤©)
- [ ] æ€§èƒ½æ–‡æ¡£ + å›¢é˜ŸåŸ¹è®­ (1 å¤©)

---

## ğŸ” ç›‘æ§ä¸å›å½’

### 1. æœ¬åœ°å¼€å‘éªŒè¯

```bash
# æ¯æ¬¡æ”¹åŠ¨å
npm run build
npm run start
open http://localhost:3000

# Chrome DevTools
# 1. Network é¢æ¿ â†’ æ£€æŸ¥ WebP æ ¼å¼
# 2. Performance é¢æ¿ â†’ å½•åˆ¶ trace
# 3. Lighthouse é¢æ¿ â†’ è¿è¡Œæµ‹è¯•
```

### 2. ç”Ÿäº§ç¯å¢ƒç›‘æ§

- **PageSpeed Insights**: https://pagespeed.web.dev/
- **Vercel Analytics**: Dashboard â†’ Web Vitals
- **Chrome User Experience Report**: https://crux.run/

### 3. æ€§èƒ½å›å½’é˜»æ–­

- PR åˆå¹¶å‰å¿…é¡»é€šè¿‡ Lighthouse CI
- Performance åˆ†æ•° < 80 â†’ è‡ªåŠ¨ Fail
- LCP > 2.5s â†’ è§¦å‘å‘Šè­¦

---

## ğŸ“š å‚è€ƒæ–‡æ¡£

- [Optimize LCP - Web.dev](https://web.dev/articles/optimize-lcp)
- [Next.js Image Optimization](https://nextjs.org/docs/app/building-your-application/optimizing/images)
- [Resource Hints - Web.dev](https://web.dev/learn/performance/resource-hints)
- [Font Display - Web.dev](https://web.dev/font-display/)
- [Vercel Compression](https://vercel.com/docs/compression)
- [Lighthouse CI](https://github.com/GoogleChrome/lighthouse-ci)

---

## âœ… éªŒæ”¶æ ‡å‡†

ä¼˜åŒ–å®Œæˆåï¼Œéœ€æ»¡è¶³ä»¥ä¸‹æ¡ä»¶ï¼š

1. âœ… PageSpeed Insights Desktop Performance â‰¥ 80
2. âœ… LCP â‰¤ 2.5s
3. âœ… TBT â‰¤ 500ms (ç†æƒ³ â‰¤200ms éœ€ SSG)
4. âœ… FCP â‰¤ 1.8s
5. âœ… CLS â‰¤ 0.1
6. âœ… èƒŒæ™¯å›¾ â‰¤ 200KB (WebP æ ¼å¼)
7. âœ… é¦–å±æ—  YouTube iframe é˜»å¡
8. âœ… å­—ä½“åŠ è½½æ— é—ªçƒ
9. âœ… é™æ€èµ„æºç¼“å­˜ 1 å¹´
10. âœ… Lighthouse CI é›†æˆåˆ° PR æµç¨‹

---

**æ–‡æ¡£ç‰ˆæœ¬:** v1.0
**æ›´æ–°æ—¥æœŸ:** 2025-11-24
**ç»´æŠ¤äºº:** Deadly Delivery å¼€å‘å›¢é˜Ÿ

# Where Winds Meet 广告放置技术文档

> 本文档定义项目中所有广告位的放置策略、页面分布和实现方式

---

## 一、广告资源清单

### 可用广告类型

| 广告类型 | 标识符 | 尺寸 | 实现方式 | 特点 |
|---------|--------|------|----------|------|
| 社交栏广告 | `social-bar` | 自适应 | 直接脚本注入 | 浮动在页面底部，全站唯一 |
| 横幅广告 | `banner-invoke` | 自适应 | invoke.js + div | 响应式横幅 |
| 横幅广告 | `banner-300x250` | 300×250 | iframe 嵌入 | 适合内容区/侧边栏 |
| 横幅广告 | `banner-468x60` | 468×60 | iframe 嵌入 | 适合内容区顶部/底部 |
| 横幅广告 | `banner-728x90` | 728×90 | iframe 嵌入 | 适合页面顶部/大屏幕 |

### 广告 Key 对照表

| 广告类型 | Key / 脚本源 |
|---------|-------------|
| 社交栏 | `6f8df914dbd7de4b6630205d13ef18f2` |
| banner-invoke | `403646c65d80b691a3a543bbfb5f26dc` |
| banner-300x250 | `c53f26cd5dd4b0c0dc2c38d04fb7dac4` |
| banner-468x60 | `7bf291d457892c566d470d55f9a95aa5` |
| banner-728x90 | `3d35ec654264d30c9ea64033f7af7f2e` |

---

## 二、页面分类与广告策略

### 页面层级分类

```
├── 首页 (/)                           → 高流量入口
├── 列表页面 (16个)                     → 中等流量
│   ├── /builds/
│   ├── /bosses/
│   ├── /guides/
│   ├── /news/
│   ├── /pc/
│   ├── /system/
│   ├── /community/
│   ├── /media/
│   ├── /store/
│   ├── /support/
│   ├── /collectibles/
│   ├── /console/
│   ├── /lore/
│   └── /quests/
└── 内容详情页 ([...slug])             → 高流量，用户停留时间长
```

### 广告分布原则

1. **社交栏广告**：全站唯一，放置在根布局 `layout.tsx` 中
2. **iframe 横幅广告**：每种尺寸在同一页面只出现一次
3. **用户体验优先**：首屏不超过 1 个广告，整页不超过 3 个广告
4. **响应式考虑**：大尺寸广告 (728x90) 在移动端隐藏

---

## 三、广告位放置方案

### 3.1 全站布局 (layout.tsx)

| 广告位 | 广告类型 | 位置 | 说明 |
|--------|----------|------|------|
| 全站社交栏 | `social-bar` | `</body>` 标签前 | 浮动底部栏，全站所有页面可见 |

**实现方式**：
- 在 `src/app/layout.tsx` 的 `<body>` 结束标签前插入脚本
- 使用 Next.js 的 `Script` 组件，策略设为 `afterInteractive`

---

### 3.2 首页 (page.tsx)

| 广告位 | 广告类型 | 放置位置 | 说明 |
|--------|----------|----------|------|
| 首页顶部横幅 | `banner-728x90` | Hero 区域上方 | 桌面端显示，移动端隐藏 |
| 首页中部横幅 | `banner-300x250` | BuildPicker 组件下方 | 交互工具后展示 |

**布局示意**：
```
┌────────────────────────────────────────┐
│           [banner-728x90]              │  ← 桌面端可见
├────────────────────────────────────────┤
│                                        │
│              Hero 区域                  │
│                                        │
├────────────────────────────────────────┤
│           BuildPicker 组件             │
├────────────────────────────────────────┤
│           [banner-300x250]             │  ← 工具下方
├────────────────────────────────────────┤
│           BuildBarChart 组件           │
└────────────────────────────────────────┘
```

---

### 3.3 列表页面 (builds, bosses, guides 等)

将 16 个列表页面分为 3 组，每组使用不同的广告组合：

#### A 组（高优先级列表页）

**页面**：`/builds`, `/guides`, `/bosses`, `/news`

| 广告位 | 广告类型 | 放置位置 |
|--------|----------|----------|
| 列表顶部 | `banner-468x60` | 页面标题下方，列表上方 |

#### B 组（中优先级列表页）

**页面**：`/pc`, `/system`, `/store`, `/quests`

| 广告位 | 广告类型 | 放置位置 |
|--------|----------|----------|
| 列表底部 | `banner-300x250` | 列表下方，Footer 上方 |

#### C 组（低优先级列表页）

**页面**：`/community`, `/media`, `/support`, `/collectibles`, `/console`, `/lore`

| 广告位 | 广告类型 | 放置位置 |
|--------|----------|----------|
| 无额外广告 | - | 仅依赖全站社交栏 |

**说明**：C 组页面流量较低或用户体验敏感（如 support），不额外放置广告

---

### 3.4 内容详情页 ([...slug]/page.tsx)

内容详情页是用户停留时间最长的页面，可放置更多广告：

| 广告位 | 广告类型 | 放置位置 | 显示条件 |
|--------|----------|----------|----------|
| 文章顶部 | `banner-invoke` | 面包屑下方，文章标题上方 | 所有设备 |
| 文章底部 | `banner-468x60` | 文章内容结束后 | 所有设备 |

**布局示意**：
```
┌────────────────────────────────────────┐
│           Breadcrumb 导航              │
├────────────────────────────────────────┤
│           [banner-invoke]              │  ← 响应式横幅
├────────────────────────────────────────┤
│           文章标题 (H1)                 │
├────────────────────────────────────────┤
│                                        │
│           文章内容 (MDX)                │
│                                        │
├────────────────────────────────────────┤
│           [banner-468x60]              │  ← 文章结束
├────────────────────────────────────────┤
│           相关推荐 / Footer            │
└────────────────────────────────────────┘
```

---

## 四、广告位汇总表

### 按页面统计

| 页面类型 | 页面数量 | 广告位数量 | 广告类型 |
|---------|---------|-----------|---------|
| 全站布局 | 1 | 1 | social-bar |
| 首页 | 1 | 2 | banner-728x90, banner-300x250 |
| A 组列表页 | 4 | 各 1 | banner-468x60 |
| B 组列表页 | 4 | 各 1 | banner-300x250 |
| C 组列表页 | 6 | 0 | - |
| 内容详情页 | 78+ | 各 2 | banner-invoke, banner-468x60 |

### 按广告类型统计

| 广告类型 | 展示页面数 | 位置说明 |
|---------|-----------|----------|
| social-bar | 全站所有页面 | 底部浮动 |
| banner-728x90 | 1 (首页) | 首页 Hero 上方 |
| banner-invoke | 78+ (详情页) | 文章顶部 |
| banner-468x60 | 82+ (A 组 + 详情页) | 列表顶部 / 文章底部 |
| banner-300x250 | 5 (首页 + B 组) | 首页工具下方 / 列表底部 |

---

## 五、实现方式详解

### 5.1 目录结构

```
public/
└── ads/
    ├── banner-300x250.html
    ├── banner-468x60.html
    └── banner-728x90.html

src/
├── app/
│   └── layout.tsx              ← 社交栏广告
├── components/
│   └── ads/
│       ├── AdBanner.tsx        ← iframe 横幅组件
│       ├── AdBannerInvoke.tsx  ← invoke.js 横幅组件
│       └── SocialBar.tsx       ← 社交栏组件 (可选)
```

### 5.2 组件实现规范

#### AdBanner 组件（iframe 方式）

**用途**：封装 300x250、468x60、728x90 三种 iframe 横幅

**Props 设计**：
```typescript
interface AdBannerProps {
  type: 'banner-300x250' | 'banner-468x60' | 'banner-728x90';
  className?: string;  // 用于外层容器样式控制
}
```

**要点**：
- 必须是 Client Component（`'use client'`）
- 通过 iframe 加载 `/ads/{type}.html`
- 设置 `border: none` 和 `overflow: hidden`
- 添加 `title` 属性提升可访问性

#### AdBannerInvoke 组件（invoke.js 方式）

**用途**：封装响应式 invoke.js 横幅

**实现方式**：
- 使用 `useEffect` 在客户端挂载后动态加载脚本
- 通过 `useRef` 获取容器 DOM 引用
- 确保每个实例只加载一次

**要点**：
- 必须是 Client Component
- 使用 `useId()` 或固定 ID 确保 div 唯一性
- 清理函数中移除注入的脚本

#### 社交栏广告

**实现位置**：`src/app/layout.tsx`

**实现方式**：
- 使用 Next.js `Script` 组件
- 策略设为 `afterInteractive`
- 放置在 `<body>` 内部最后

---

## 六、响应式适配方案

### 6.1 断点定义

| 断点名称 | 宽度范围 | 说明 |
|---------|---------|------|
| mobile | < 640px | 手机 |
| tablet | 640px - 1023px | 平板 |
| desktop | >= 1024px | 桌面 |

### 6.2 广告显示规则

| 广告类型 | mobile | tablet | desktop |
|---------|--------|--------|---------|
| social-bar | 显示 | 显示 | 显示 |
| banner-728x90 | 隐藏 | 隐藏 | 显示 |
| banner-468x60 | 显示 | 显示 | 显示 |
| banner-300x250 | 显示 | 显示 | 显示 |
| banner-invoke | 显示 | 显示 | 显示 |

**实现方式**：使用 Tailwind CSS 的响应式类

```tsx
{/* 仅桌面端显示 */}
<div className="hidden lg:block">
  <AdBanner type="banner-728x90" />
</div>

{/* 所有设备显示 */}
<div className="flex justify-center">
  <AdBanner type="banner-468x60" />
</div>
```

---

## 七、性能优化策略

### 7.1 懒加载

**适用场景**：首屏以下的广告位

**实现方式**：
- 使用 `IntersectionObserver` API
- 当广告位进入视口 200px 范围内时开始加载
- 只加载一次，加载后停止观察

**适用广告位**：
- 首页 banner-300x250（BuildPicker 下方）
- 内容详情页 banner-468x60（文章底部）
- B 组列表页的 banner-300x250

### 7.2 预连接

**实现位置**：`src/app/layout.tsx` 的 `<head>` 内

**预连接域名**：
```html
<link rel="preconnect" href="//www.highperformanceformat.com" />
<link rel="preconnect" href="//pl28124752.effectivegatecpm.com" />
<link rel="preconnect" href="//pl28123603.effectivegatecpm.com" />
<link rel="dns-prefetch" href="//www.highperformanceformat.com" />
```

### 7.3 加载策略优先级

| 优先级 | 广告位 | 加载时机 |
|-------|--------|---------|
| 高 | 社交栏 | afterInteractive |
| 高 | 首页 banner-728x90 | 立即加载 |
| 中 | 内容页 banner-invoke | 立即加载 |
| 低 | 首页 banner-300x250 | 懒加载 |
| 低 | 内容页 banner-468x60 | 懒加载 |
| 低 | 列表页广告 | 懒加载 |

---

## 八、注意事项

### 8.1 Adsterra 政策合规

1. **同一广告位不得重复使用**：每个 key 在单一页面只能出现一次
2. **避免过度广告**：单页广告数量控制在 3 个以内
3. **禁止隐藏广告**：不得使用 `display:none` 或 `visibility:hidden`
4. **禁止自动点击**：不得有任何诱导或自动点击行为

### 8.2 用户体验考量

1. **首屏限制**：首屏最多 1 个广告，避免影响内容加载体验
2. **内容优先**：广告不得遮挡主要内容
3. **移动端友好**：大尺寸广告在移动端隐藏
4. **Support 页面**：不放置额外广告，保持帮助页面的专业性

### 8.3 调试与测试

1. **禁用广告拦截器**：测试时需禁用 uBlock、AdBlock 等插件
2. **检查 Network 请求**：确认 invoke.js 返回 200
3. **验证 HTML 文件**：直接访问 `/ads/banner-xxx.html` 确认可访问
4. **新广告位审核**：Adsterra 新建广告位需 1-3 小时审核

---

## 九、实施检查清单

### 第一阶段：基础设施

- [ ] 创建 `public/ads/` 目录
- [ ] 创建 `banner-300x250.html`
- [ ] 创建 `banner-468x60.html`
- [ ] 创建 `banner-728x90.html`
- [ ] 创建 `src/components/ads/AdBanner.tsx` 组件
- [ ] 创建 `src/components/ads/AdBannerInvoke.tsx` 组件

### 第二阶段：全站布局

- [ ] 在 `layout.tsx` 中添加社交栏广告脚本
- [ ] 在 `layout.tsx` 中添加预连接标签

### 第三阶段：首页

- [ ] 添加 banner-728x90（Hero 上方）
- [ ] 添加 banner-300x250（BuildPicker 下方）

### 第四阶段：列表页

- [ ] A 组页面添加 banner-468x60
- [ ] B 组页面添加 banner-300x250

### 第五阶段：内容详情页

- [ ] 添加 banner-invoke（面包屑下方）
- [ ] 添加 banner-468x60（文章底部）

### 第六阶段：优化

- [ ] 实现懒加载组件
- [ ] 添加响应式隐藏类
- [ ] 测试所有页面广告显示

---

## 十、版本记录

| 版本 | 日期 | 变更说明 |
|------|------|----------|
| 1.0.0 | 2025-11-24 | 初始版本，定义完整广告放置方案 |
